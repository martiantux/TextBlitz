import{S as d}from"../../chunks/storage.js";import{l as u}from"../../chunks/logger.js";class p{constructor(){this.initialize()}async initialize(){await d.initialize(),await this.loadStatus(),this.setupEventListeners()}async loadStatus(){const e=await d.getSettings(),t=await d.getSnippets(),s=Object.values(t),l=document.getElementById("status"),n=document.getElementById("status-text"),a=document.getElementById("stats");e.enabled?(l?.classList.remove("disabled"),n&&(n.textContent="‚úì TextBlitz is active")):(l?.classList.add("disabled"),n&&(n.textContent="‚úó TextBlitz is disabled")),a&&(a.textContent=`${s.length} snippet${s.length!==1?"s":""} configured`);const o=document.getElementById("recent-list");if(o){const c=s.filter(i=>i.lastUsed).sort((i,r)=>(r.lastUsed||0)-(i.lastUsed||0)).slice(0,5);c.length===0?o.innerHTML='<div class="empty">No snippets used yet</div>':o.innerHTML=c.map(i=>`
          <div class="recent-item">
            <span class="trigger">${this.escapeHtml(i.trigger)}</span>
            <span class="expansion">‚Üí ${this.escapeHtml(i.expansion.substring(0,30))}${i.expansion.length>30?"...":""}</span>
          </div>
        `).join("")}}setupEventListeners(){document.getElementById("open-options")?.addEventListener("click",()=>{chrome.runtime.openOptionsPage()}),document.getElementById("toggle-enabled")?.addEventListener("click",async()=>{const e=await d.getSettings();e.enabled=!e.enabled,await d.saveSettings(e),await this.loadStatus()}),document.getElementById("report-bug")?.addEventListener("click",()=>{this.showBugReportModal()}),document.getElementById("cancel-bug-report")?.addEventListener("click",()=>{this.hideBugReportModal()}),document.getElementById("submit-bug-report")?.addEventListener("click",()=>{this.submitBugReport()}),document.getElementById("bug-include-logs")?.addEventListener("change",e=>{const t=e.target,s=document.getElementById("log-preview");s&&(s.style.display=t.checked?"block":"none")}),document.getElementById("bug-include-snippet")?.addEventListener("change",()=>{this.loadLogPreview()})}showBugReportModal(){document.getElementById("bug-report-modal")?.classList.add("active"),this.loadLogPreview(),document.getElementById("bug-what-happened").value="",document.getElementById("bug-what-doing").value="",document.getElementById("bug-include-logs").checked=!0,document.getElementById("bug-include-snippet").checked=!1;const t=document.getElementById("bug-status");t&&(t.style.display="none",t.className="status-message")}hideBugReportModal(){document.getElementById("bug-report-modal")?.classList.remove("active")}async loadLogPreview(){const e=document.getElementById("log-preview");if(!e)return;const t=document.getElementById("bug-include-snippet")?.checked||!1;let s=null;if(t){const n=await d.getSnippets(),a=Object.values(n).filter(o=>o.lastUsed).sort((o,c)=>(c.lastUsed||0)-(o.lastUsed||0));a.length>0&&(s={trigger:a[0].trigger,label:a[0].label,expansion:a[0].expansion,type:a[0].type})}const l=u.formatForGitHub(t,s);e.textContent=l}async submitBugReport(){const e=document.getElementById("bug-what-happened").value.trim(),t=document.getElementById("bug-what-doing").value.trim();document.getElementById("bug-include-logs").checked;const s=document.getElementById("bug-include-snippet").checked;document.getElementById("bug-status");const l=document.getElementById("submit-bug-report");if(!e||!t){this.showStatus("error","Please fill in both description fields");return}try{l.disabled=!0,this.showStatus("error","‚è≥ Preparing bug report...");let n=`## User Description

`;n+=`**What happened:** ${e}

`,n+=`**What were you doing:** ${t}

`,n+=`---

`;let a=null;if(s){const c=await d.getSnippets(),i=Object.values(c).filter(r=>r.lastUsed).sort((r,g)=>(g.lastUsed||0)-(r.lastUsed||0));i.length>0&&(a={trigger:i[0].trigger,label:i[0].label,expansion:i[0].expansion,type:i[0].type})}n+=u.formatForGitHub(s,a),await navigator.clipboard.writeText(n),this.showStatus("success",`üìã Report copied to clipboard!

Submit via:
‚Ä¢ GitHub: https://github.com/martiantux/TextBlitz/issues/new
‚Ä¢ Email: bradley@hammond.im

Click outside to close`)}catch(n){console.error("Bug report submission failed:",n),this.showStatus("error",`‚ùå Failed: ${n instanceof Error?n.message:"Unknown error"}.
Try manually reporting at github.com/martiantux/TextBlitz/issues`)}finally{l.disabled=!1}}showStatus(e,t){const s=document.getElementById("bug-status");s&&(s.className=`status-message ${e}`,s.textContent=t,s.style.display="block")}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}}new p;
