const l=class l{static parse(e){const t=[],s=new RegExp(this.COMMAND_REGEX);let r;for(;(r=s.exec(e))!==null;){const[n,o,a]=r;t.push({type:o,options:a?.trim()||void 0,startIndex:r.index,endIndex:r.index+n.length,rawMatch:n})}return t}static parseFormCommands(e){const t=[],s=new RegExp(this.FORM_COMMAND_REGEX);let r;for(;(r=s.exec(e))!==null;){const[n,o,a]=r,i=this.parseFormField(o,a);i&&t.push({type:"form",options:a,startIndex:r.index,endIndex:r.index+n.length,rawMatch:n,formField:i})}return t}static parseFormField(e,t){const s=t.split(";").map(i=>i.trim()),r={};for(const i of s){const[c,p]=i.split("=").map(u=>u.trim());c&&p&&(r[c]=p)}const n=r.label||r.name||"Field",o=r.name||n.toLowerCase().replace(/\s+/g,"_"),a={type:e.replace("form",""),name:o,label:n,required:r.required==="true"};return e==="formmenu"&&r.options&&(a.options=r.options.split(",").map(i=>i.trim())),r.default&&(a.defaultValue=e==="formtoggle"?r.default==="true":r.default),a}static hasFormCommands(e){return this.FORM_COMMAND_REGEX.test(e)}static extractFormFields(e){return this.parseFormCommands(e).map(s=>s.formField).filter(Boolean)}static stripNotes(e){return e.replace(this.NOTE_BLOCK_REGEX,"").replace(this.NOTE_INLINE_REGEX,"")}static getSiteInfo(e){switch(e.toLowerCase().trim()){case"domain":return window.location.hostname;case"title":return document.title;case"url":return window.location.href;case"selection":return window.getSelection()?.toString()||"";default:return console.warn(`TextBlitz: Unknown site parameter: ${e}`),""}}static addToHistory(e){!e||this.clipboardHistory.length>0&&this.clipboardHistory[0]===e||(this.clipboardHistory.unshift(e),this.clipboardHistory.length>this.MAX_HISTORY&&(this.clipboardHistory=this.clipboardHistory.slice(0,this.MAX_HISTORY)))}static getClipboardHistory(e){return this.clipboardHistory[e-1]||""}static clearClipboardHistory(){this.clipboardHistory=[]}static normalizeKeyName(e){const t=e.toLowerCase().trim();return this.KEY_MAP[t]||null}static getOrdinalSuffix(e){if(e>=11&&e<=13)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}static parseDateShift(e){const t=e.match(/shift\s+([+-]?\d+)([dMY])/);if(!t)return null;const s=parseInt(t[1],10),r=t[2];return{value:s,unit:r}}static applyDateShift(e,t){const s=new Date(e);switch(t.unit){case"d":s.setDate(s.getDate()+t.value);break;case"M":s.setMonth(s.getMonth()+t.value);break;case"Y":s.setFullYear(s.getFullYear()+t.value);break}return s}static formatDate(e,t){let s=e,r=t||"YYYY-MM-DD";if(t){const d=this.parseDateShift(t);d&&(s=this.applyDateShift(e,d),r=t.replace(/\s*shift\s+[+-]?\d+[dMY]\s*/,"").trim()||"YYYY-MM-DD")}const n=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),a=s.getDate(),i=String(a).padStart(2,"0"),c=s.toLocaleDateString("en-US",{month:"long"}),p=s.toLocaleDateString("en-US",{month:"short"}),u={YYYY:String(n),YY:String(n).slice(-2),MMMM:c,MMM:p,MM:o,M:String(s.getMonth()+1),Do:`${a}${this.getOrdinalSuffix(a)}`,DD:i,D:String(a)},m=Object.keys(u).sort((d,f)=>f.length-d.length),y=new RegExp(m.join("|"),"g");return r.replace(y,d=>u[d]||d)}static formatTime(e,t){const r=t||"HH:mm",n=e.getHours(),o=n%12||12,a=String(e.getMinutes()).padStart(2,"0"),i=String(e.getSeconds()).padStart(2,"0"),c=n>=12?"PM":"AM";return r==="12h"?`${o}:${a} ${c}`:r==="24h"?`${String(n).padStart(2,"0")}:${a}`:r.replace("HH",String(n).padStart(2,"0")).replace("H",String(n)).replace("hh",String(o).padStart(2,"0")).replace("h",String(o)).replace("mm",a).replace("ss",i).replace("A",c).replace("a",c.toLowerCase())}static parseDelayMs(e){if(!e)return 0;const t=e.match(/\+?(\d+(?:\.\d+)?)(s|ms)?/);if(!t)return 0;const s=parseFloat(t[1]);return(t[2]||"s")==="ms"?s:s*1e3}static async processCommands(e){const t=this.parse(e);if(t.length===0)return e;let s=e;const r=new Date;for(let n=t.length-1;n>=0;n--){const o=t[n];let a;switch(o.type){case"date":a=this.formatDate(r,o.options);break;case"time":a=this.formatTime(r,o.options);break;case"clipboard":const i=o.rawMatch.match(/clipboardh(\d+)/);if(i){const c=parseInt(i[1],10)-1;a=this.clipboardHistory[c]||""}else try{a=await navigator.clipboard.readText(),this.addToHistory(a)}catch{console.warn("TextBlitz: Clipboard access denied or unavailable"),a=o.rawMatch}break;case"site":a=this.getSiteInfo(o.options||"url");break;case"cursor":case"enter":case"tab":case"delay":case"key":continue;default:a=o.rawMatch}s=s.slice(0,o.startIndex)+a+s.slice(o.endIndex)}return s}static extractKeyboardActions(e){const t=this.parse(e),s=[];let r=e,n=0;for(const o of t)if(o.type==="enter"||o.type==="tab"||o.type==="delay"||o.type==="key"){const a=o.startIndex-n;s.push({type:o.type,options:o.options,position:a}),r=r.slice(0,o.startIndex-n)+r.slice(o.endIndex-n),n+=o.rawMatch.length}return{text:r,actions:s}}static splitTextByKeyboardActions(e){const s=this.parse(e).filter(a=>a.type==="enter"||a.type==="tab"||a.type==="delay"||a.type==="key");if(s.length===0)return{chunks:[e],actions:[]};const r=[],n=[];let o=0;for(const a of s)r.push(e.substring(o,a.startIndex)),n.push({type:a.type,options:a.options}),o=a.endIndex;return r.push(e.substring(o)),{chunks:r,actions:n}}static substituteFormValues(e,t){const s=this.parseFormCommands(e);if(s.length===0)return e;let r=e;for(let n=s.length-1;n>=0;n--){const o=s[n];if(o.formField){const a=t[o.formField.name],i=a!==void 0?String(a):"";r=r.slice(0,o.startIndex)+i+r.slice(o.endIndex)}}return r}};l.clipboardHistory=[],l.MAX_HISTORY=10,l.COMMAND_REGEX=/\{(date|time|clipboard(?:h\d+)?|cursor|enter|tab|delay|site|key)(?:[\s:]([^}]+))?\}/g,l.FORM_COMMAND_REGEX=/\{(formtext|formparagraph|formmenu|formdate|formtoggle):([^}]+)\}/g,l.NOTE_BLOCK_REGEX=/\{note\}(.*?)\{endnote\}/gs,l.NOTE_INLINE_REGEX=/\{note:\s*[^}]*\}/g,l.KEY_MAP={enter:{code:"Enter",key:"Enter",keyCode:13},tab:{code:"Tab",key:"Tab",keyCode:9},escape:{code:"Escape",key:"Escape",keyCode:27},esc:{code:"Escape",key:"Escape",keyCode:27},backspace:{code:"Backspace",key:"Backspace",keyCode:8},delete:{code:"Delete",key:"Delete",keyCode:46},arrowup:{code:"ArrowUp",key:"ArrowUp",keyCode:38},arrowdown:{code:"ArrowDown",key:"ArrowDown",keyCode:40},arrowleft:{code:"ArrowLeft",key:"ArrowLeft",keyCode:37},arrowright:{code:"ArrowRight",key:"ArrowRight",keyCode:39},home:{code:"Home",key:"Home",keyCode:36},end:{code:"End",key:"End",keyCode:35},pageup:{code:"PageUp",key:"PageUp",keyCode:33},pagedown:{code:"PageDown",key:"PageDown",keyCode:34},space:{code:"Space",key:" ",keyCode:32},f1:{code:"F1",key:"F1",keyCode:112},f2:{code:"F2",key:"F2",keyCode:113},f3:{code:"F3",key:"F3",keyCode:114},f4:{code:"F4",key:"F4",keyCode:115},f5:{code:"F5",key:"F5",keyCode:116},f6:{code:"F6",key:"F6",keyCode:117},f7:{code:"F7",key:"F7",keyCode:118},f8:{code:"F8",key:"F8",keyCode:119},f9:{code:"F9",key:"F9",keyCode:120},f10:{code:"F10",key:"F10",keyCode:121},f11:{code:"F11",key:"F11",keyCode:122},f12:{code:"F12",key:"F12",keyCode:123}};let h=l;const k=Object.freeze(Object.defineProperty({__proto__:null,CommandParser:h},Symbol.toStringTag,{value:"Module"}));class w{static detectCase(e){if(!e)return"lower";const t=/[a-z]/.test(e),s=/[A-Z]/.test(e);if(!t&&!s)return"lower";if(!t&&s)return"upper";if(t&&!s)return"lower";if(/^[A-Z]/.test(e)){const r=e.split(/\s+/),n=r.filter(o=>/^[A-Z]/.test(o));return n.length>1||r.length>1&&n.length===r.length?"title":"capitalize"}return"mixed"}static transform(e,t,s){switch(t){case"upper":return e.toUpperCase();case"lower":return e.toLowerCase();case"title":return this.toTitleCase(e);case"capitalize":return this.capitalize(e);case"match":return s?this.matchCase(e,s):e;case"none":default:return e}}static toTitleCase(e){return e.split(/(\s+)/).map(t=>/^\s+$/.test(t)?t:t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join("")}static capitalize(e){return e&&e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}static matchCase(e,t){switch(this.detectCase(t)){case"upper":return e.toUpperCase();case"lower":return e.toLowerCase();case"title":return this.toTitleCase(e);case"capitalize":return this.capitalize(e);default:return e}}}export{h as C,w as a,k as c};
