const d=class d{static parse(e){const t=[],r=new RegExp(this.COMMAND_REGEX);let s;for(;(s=r.exec(e))!==null;){const[n,a,o]=s;t.push({type:a,options:o?.trim()||void 0,startIndex:s.index,endIndex:s.index+n.length,rawMatch:n})}return t}static parseFormCommands(e){const t=[],r=new RegExp(this.FORM_COMMAND_REGEX);let s;for(;(s=r.exec(e))!==null;){const[n,a,o]=s,c=this.parseFormField(a,o);c&&t.push({type:"form",options:o,startIndex:s.index,endIndex:s.index+n.length,rawMatch:n,formField:c})}return t}static parseFormField(e,t){const r=t.split(";").map(c=>c.trim()),s={};for(const c of r){const[i,p]=c.split("=").map(u=>u.trim());i&&p&&(s[i]=p)}const n=s.label||s.name||"Field",a=s.name||n.toLowerCase().replace(/\s+/g,"_"),o={type:e.replace("form",""),name:a,label:n,required:s.required==="true"};return e==="formmenu"&&s.options&&(o.options=s.options.split(",").map(c=>c.trim())),s.default&&(o.defaultValue=e==="formtoggle"?s.default==="true":s.default),o}static hasFormCommands(e){return this.FORM_COMMAND_REGEX.test(e)}static extractFormFields(e){return this.parseFormCommands(e).map(r=>r.formField).filter(Boolean)}static stripNotes(e){return e.replace(this.NOTE_BLOCK_REGEX,"").replace(this.NOTE_INLINE_REGEX,"")}static getSiteInfo(e){switch(e.toLowerCase().trim()){case"domain":return window.location.hostname;case"title":return document.title;case"url":return window.location.href;case"selection":return window.getSelection()?.toString()||"";default:return console.warn(`TextBlitz: Unknown site parameter: ${e}`),""}}static normalizeKeyName(e){const t=e.toLowerCase().trim();return this.KEY_MAP[t]||null}static getOrdinalSuffix(e){if(e>=11&&e<=13)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}static parseDateShift(e){const t=e.match(/shift\s+([+-]?\d+)([dMY])/);if(!t)return null;const r=parseInt(t[1],10),s=t[2];return{value:r,unit:s}}static applyDateShift(e,t){const r=new Date(e);switch(t.unit){case"d":r.setDate(r.getDate()+t.value);break;case"M":r.setMonth(r.getMonth()+t.value);break;case"Y":r.setFullYear(r.getFullYear()+t.value);break}return r}static formatDate(e,t){let r=e,s=t||"YYYY-MM-DD";if(t){const l=this.parseDateShift(t);l&&(r=this.applyDateShift(e,l),s=t.replace(/\s*shift\s+[+-]?\d+[dMY]\s*/,"").trim()||"YYYY-MM-DD")}const n=r.getFullYear(),a=String(r.getMonth()+1).padStart(2,"0"),o=r.getDate(),c=String(o).padStart(2,"0"),i=r.toLocaleDateString("en-US",{month:"long"}),p=r.toLocaleDateString("en-US",{month:"short"}),u={YYYY:String(n),YY:String(n).slice(-2),MMMM:i,MMM:p,MM:a,M:String(r.getMonth()+1),Do:`${o}${this.getOrdinalSuffix(o)}`,DD:c,D:String(o)},h=Object.keys(u).sort((l,y)=>y.length-l.length),f=new RegExp(h.join("|"),"g");return s.replace(f,l=>u[l]||l)}static formatTime(e,t){const s=t||"HH:mm",n=e.getHours(),a=n%12||12,o=String(e.getMinutes()).padStart(2,"0"),c=String(e.getSeconds()).padStart(2,"0"),i=n>=12?"PM":"AM";return s==="12h"?`${a}:${o} ${i}`:s==="24h"?`${String(n).padStart(2,"0")}:${o}`:s.replace("HH",String(n).padStart(2,"0")).replace("H",String(n)).replace("hh",String(a).padStart(2,"0")).replace("h",String(a)).replace("mm",o).replace("ss",c).replace("A",i).replace("a",i.toLowerCase())}static parseDelayMs(e){if(!e)return 0;const t=e.match(/\+?(\d+(?:\.\d+)?)(s|ms)?/);if(!t)return 0;const r=parseFloat(t[1]);return(t[2]||"s")==="ms"?r:r*1e3}static async processCommands(e){const t=this.parse(e);if(t.length===0)return e;let r=e;const s=new Date;for(let n=t.length-1;n>=0;n--){const a=t[n];let o;switch(a.type){case"date":o=this.formatDate(s,a.options);break;case"time":o=this.formatTime(s,a.options);break;case"clipboard":try{o=await navigator.clipboard.readText()}catch{console.warn("TextBlitz: Clipboard access denied or unavailable"),o=a.rawMatch}break;case"site":o=this.getSiteInfo(a.options||"url");break;case"cursor":case"enter":case"tab":case"delay":case"key":continue;default:o=a.rawMatch}r=r.slice(0,a.startIndex)+o+r.slice(a.endIndex)}return r}static extractKeyboardActions(e){const t=this.parse(e),r=[];let s=e,n=0;for(const a of t)if(a.type==="enter"||a.type==="tab"||a.type==="delay"||a.type==="key"){const o=a.startIndex-n;r.push({type:a.type,options:a.options,position:o}),s=s.slice(0,a.startIndex-n)+s.slice(a.endIndex-n),n+=a.rawMatch.length}return{text:s,actions:r}}static splitTextByKeyboardActions(e){const r=this.parse(e).filter(o=>o.type==="enter"||o.type==="tab"||o.type==="delay"||o.type==="key");if(r.length===0)return{chunks:[e],actions:[]};const s=[],n=[];let a=0;for(const o of r)s.push(e.substring(a,o.startIndex)),n.push({type:o.type,options:o.options}),a=o.endIndex;return s.push(e.substring(a)),{chunks:s,actions:n}}static substituteFormValues(e,t){const r=this.parseFormCommands(e);if(r.length===0)return e;let s=e;for(let n=r.length-1;n>=0;n--){const a=r[n];if(a.formField){const o=t[a.formField.name],c=o!==void 0?String(o):"";s=s.slice(0,a.startIndex)+c+s.slice(a.endIndex)}}return s}};d.COMMAND_REGEX=/\{(date|time|clipboard|cursor|enter|tab|delay|site|key)(?:[\s:]([^}]+))?\}/g,d.FORM_COMMAND_REGEX=/\{(formtext|formparagraph|formmenu|formdate|formtoggle):([^}]+)\}/g,d.NOTE_BLOCK_REGEX=/\{note\}(.*?)\{endnote\}/gs,d.NOTE_INLINE_REGEX=/\{note:\s*[^}]*\}/g,d.KEY_MAP={enter:{code:"Enter",key:"Enter",keyCode:13},tab:{code:"Tab",key:"Tab",keyCode:9},escape:{code:"Escape",key:"Escape",keyCode:27},esc:{code:"Escape",key:"Escape",keyCode:27},backspace:{code:"Backspace",key:"Backspace",keyCode:8},delete:{code:"Delete",key:"Delete",keyCode:46},arrowup:{code:"ArrowUp",key:"ArrowUp",keyCode:38},arrowdown:{code:"ArrowDown",key:"ArrowDown",keyCode:40},arrowleft:{code:"ArrowLeft",key:"ArrowLeft",keyCode:37},arrowright:{code:"ArrowRight",key:"ArrowRight",keyCode:39},home:{code:"Home",key:"Home",keyCode:36},end:{code:"End",key:"End",keyCode:35},pageup:{code:"PageUp",key:"PageUp",keyCode:33},pagedown:{code:"PageDown",key:"PageDown",keyCode:34},space:{code:"Space",key:" ",keyCode:32},f1:{code:"F1",key:"F1",keyCode:112},f2:{code:"F2",key:"F2",keyCode:113},f3:{code:"F3",key:"F3",keyCode:114},f4:{code:"F4",key:"F4",keyCode:115},f5:{code:"F5",key:"F5",keyCode:116},f6:{code:"F6",key:"F6",keyCode:117},f7:{code:"F7",key:"F7",keyCode:118},f8:{code:"F8",key:"F8",keyCode:119},f9:{code:"F9",key:"F9",keyCode:120},f10:{code:"F10",key:"F10",keyCode:121},f11:{code:"F11",key:"F11",keyCode:122},f12:{code:"F12",key:"F12",keyCode:123}};let m=d;const k=Object.freeze(Object.defineProperty({__proto__:null,CommandParser:m},Symbol.toStringTag,{value:"Module"}));class w{static detectCase(e){if(!e)return"lower";const t=/[a-z]/.test(e),r=/[A-Z]/.test(e);if(!t&&!r)return"lower";if(!t&&r)return"upper";if(t&&!r)return"lower";if(/^[A-Z]/.test(e)){const s=e.split(/\s+/),n=s.filter(a=>/^[A-Z]/.test(a));return n.length>1||s.length>1&&n.length===s.length?"title":"capitalize"}return"mixed"}static transform(e,t,r){switch(t){case"upper":return e.toUpperCase();case"lower":return e.toLowerCase();case"title":return this.toTitleCase(e);case"capitalize":return this.capitalize(e);case"match":return r?this.matchCase(e,r):e;case"none":default:return e}}static toTitleCase(e){return e.split(/(\s+)/).map(t=>/^\s+$/.test(t)?t:t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join("")}static capitalize(e){return e&&e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}static matchCase(e,t){switch(this.detectCase(t)){case"upper":return e.toUpperCase();case"lower":return e.toLowerCase();case"title":return this.toTitleCase(e);case"capitalize":return this.capitalize(e);default:return e}}}export{m as C,w as a,k as c};
